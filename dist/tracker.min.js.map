{"version":3,"file":"tracker.min.js","sources":["../src/utils/util.ts","../src/constant/index.ts","../src/utils/base64.ts","../src/core/trackerInfo.ts","../src/core/config.ts","../src/core/user.ts","../src/core/send.ts","../src/utils/http.ts","../src/core/clientInfo.ts","../src/core/actionTracker.ts","../src/core/pageTimeTracker.ts","../src/decoratiors/tools.ts","../src/directives/trackView.ts","../src/directives/trackEvent.ts","../src/utils/hijackHistoryEvent.ts","../src/core/bindEvent.ts","../src/index.ts","../src/internal.ts","../src/decoratiors/track.ts"],"sourcesContent":["import { isFunction } from 'lodash/fp'\n// import curry from 'lodash/fp/curry'\nimport { curryN } from 'lodash/fp'\nimport { attempt } from 'lodash/fp'\nimport { isError } from 'lodash/fp'\nimport { isArray } from 'lodash/fp'\nimport { once } from 'lodash/fp'\nimport { reduce } from 'lodash/fp'\nimport { memoize } from 'lodash/fp'\nimport { mapValues } from 'lodash/fp'\nimport { set as propSet } from 'lodash/fp'\n\nimport { isEqual } from 'lodash/fp'\n\nexport {\n  propSet,\n  curryN,\n  attempt,\n  isError,\n  isFunction,\n  isArray,\n  once,\n  reduce,\n  memoize,\n  mapValues\n}\n\nexport function isThenable(f: any) {\n  return f && isFunction(f.then)\n}\n\nexport function getCookie(name: string) {\n  let cookies = document.cookie.split('')\n  for (let i in cookies) {\n    let arr = cookies[i].split('=')\n    if (name == arr[0]) {\n      return unescape(arr[1]).replace(/&&&&/g, ';')\n    }\n  }\n  return null\n}\n\nexport function setCookie(\n  name: string,\n  value: string,\n  expires: number = 9999999,\n  path: string = '/',\n  domain?: string\n) {\n  document.cookie =\n    name +\n    '=' +\n    value.replace(/;/g, '&&&&') +\n    (expires ? '; expires=' + getExpires(expires) : '') +\n    (path ? '; path=' + path : '') +\n    (domain ? '; domain=' + domain : '')\n\n  function getExpires(hours: number) {\n    let date = new Date()\n    date.setTime(date.getTime() + hours * 60 * 60 * 1000)\n    return date.toUTCString()\n  }\n}\n\nexport function notChanged(binding: any) {\n  if (binding.oldValue !== undefined) {\n    if (typeof binding.value === 'object') {\n      return isEqual(binding.value, binding.oldValue)\n    } else {\n      return binding.value === binding.oldValue\n    }\n  } else {\n    return false\n  }\n}\n\n/**\n * if the binding value is empty\n */\nexport function isEmpty(binding: any) {\n  return (\n    binding.value === '' ||\n    binding.value === undefined ||\n    binding.value === null\n  )\n}\n\nexport function setFlag(key: string, value = true) {\n  window._trackerFlag = window._trackerFlag || {}\n  window._trackerFlag[key] = value\n}\n\nexport function getFlag(key: string) {\n  window._trackerFlag = window._trackerFlag || {}\n  return window._trackerFlag[key] || false\n}\n\nexport function getUUID() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    var r = (Math.random() * 16) | 0,\n      v = c == 'x' ? r : (r & 0x3) | 0x8\n    return v.toString(16)\n  })\n}\n\nexport function getDomPath(dom: HTMLElement) {\n  let path = [dom.id ? '#' + dom.id : dom.tagName.toLowerCase()]\n  while (dom.parentNode && (dom.parentNode as HTMLElement).tagName !== 'BODY') {\n    dom = dom.parentNode as HTMLElement\n    path.unshift(dom.id ? '#' + dom.id : dom.tagName.toLowerCase())\n  }\n  return path.join('>')\n}\n\nexport function noop() {}\n\nexport function isString(value: any) {\n  return Object.prototype.toString.call(value) === '[object String]'\n}\n\nexport function getLocationHref() {\n  if (typeof document === 'undefined' || document.location == null) return ''\n\n  return document.location.href\n}\n\nexport function oneOf(one: any, all: any[]) {\n  for (let i in all) {\n    if (one === all[i]) {\n      return true\n    }\n  }\n  return false\n}\n","export const SERVER_URL=\"http://127.0.0.1:7001/event/track.gif\";\n\nexport const TRACKER_DATA_KEY=\"TRACKER_DATA_KEY\"\n\nexport const TRACKER_IDENTIFY='TRACKER_IDENTIFY'\n\nexport const SEND_TYPE={\n  COOKIE:\"COOKIE\",\n  SYNC:\"SYNC\",\n  ASYNC:\"ASYNC\",\n  UNLOAD:\"UNLOAD\"\n}\n\n\nexport const ENVIRONMENT={\n  PRODUCTION:\"production\",\n  DEVELOPMENT:'development'\n}\n\nexport const ACTION_TYPE={\n  EVENT:\"EVENT\",\n  PAGE:\"PAGE\",\n  TIME:\"PAGE_TIME\"\n}\n","const Base64 = {\n  // private property\n  _keyStr: \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\",\n\n  // public method for encoding\n\n  encode: function(input:string) {\n    var output = \"\";\n\n    var chr1,\n      chr2,\n      chr3,\n      enc1,\n      enc2,\n      enc3,\n      enc4;\n\n    var i = 0;\n\n    input = Base64._utf8_encode(input);\n\n    while (i < input.length) {\n\n      chr1 = input.charCodeAt(i++);\n\n      chr2 = input.charCodeAt(i++);\n\n      chr3 = input.charCodeAt(i++);\n\n      enc1 = chr1 >> 2;\n\n      enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);\n\n      enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);\n      enc4 = chr3 & 63;\n\n      if (isNaN(chr2)) {\n\n        enc3 = enc4 = 64;\n\n      } else if (isNaN(chr3)) {\n\n        enc4 = 64;\n\n      }\n\n      output = output + this._keyStr.charAt(enc1) + this._keyStr.charAt(enc2) + this._keyStr.charAt(enc3) + this._keyStr.charAt(enc4);\n\n    }\n\n    return output;\n\n  },\n\n  // public method for decoding\n\n  decode: function(input:string) {\n\n    var output = \"\";\n\n    var chr1,\n      chr2,\n      chr3;\n\n    var enc1,\n      enc2,\n      enc3,\n      enc4;\n\n    var i = 0;\n\n    input = input.replace(/[^A-Za-z0-9\\+\\/\\=]/g, \"\");\n\n    while (i < input.length) {\n\n      enc1 = this._keyStr.indexOf(input.charAt(i++));\n\n      enc2 = this._keyStr.indexOf(input.charAt(i++));\n\n      enc3 = this._keyStr.indexOf(input.charAt(i++));\n\n      enc4 = this._keyStr.indexOf(input.charAt(i++));\n\n      chr1 = (enc1 << 2) | (enc2 >> 4);\n\n      chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);\n\n      chr3 = ((enc3 & 3) << 6) | enc4;\n\n      output = output + String.fromCharCode(chr1);\n\n      if (enc3 != 64) {\n\n        output = output + String.fromCharCode(chr2);\n\n      }\n\n      if (enc4 != 64) {\n\n        output = output + String.fromCharCode(chr3);\n\n      }\n\n    }\n\n    output = Base64._utf8_decode(output);\n\n    return output;\n\n  },\n\n  // private method for UTF-8 encoding\n\n  _utf8_encode: function(string:string) {\n\n    string = string.replace(/\\r\\n/g, \"\\n\");\n\n    var utftext = \"\";\n\n    for (var n = 0; n < string.length; n++) {\n\n      var c = string.charCodeAt(n);\n\n      if (c < 128) {\n\n        utftext += String.fromCharCode(c);\n\n      } else if ((c > 127) && (c < 2048)) {\n\n        utftext += String.fromCharCode((c >> 6) | 192);\n\n        utftext += String.fromCharCode((c & 63) | 128);\n\n      } else {\n\n        utftext += String.fromCharCode((c >> 12) | 224);\n\n        utftext += String.fromCharCode(((c >> 6) & 63) | 128);\n\n        utftext += String.fromCharCode((c & 63) | 128);\n\n      }\n\n    }\n\n    return utftext;\n\n  },\n\n  // private method for UTF-8 decoding\n\n  _utf8_decode: function(utftext:string) {\n\n    var string = \"\";\n\n    var i = 0;\n\n    var c =0, c3 =0, c2 = 0;\n\n    while (i < utftext.length) {\n\n      c = utftext.charCodeAt(i);\n\n      if (c < 128) {\n\n        string += String.fromCharCode(c);\n\n        i++;\n\n      } else if ((c > 191) && (c < 224)) {\n\n        c2 = utftext.charCodeAt(i + 1);\n\n        string += String.fromCharCode(((c & 31) << 6) | (c2 & 63));\n\n        i += 2;\n\n      } else {\n\n        c2 = utftext.charCodeAt(i + 1);\n\n        c3 = utftext.charCodeAt(i + 2);\n\n        string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));\n\n        i += 3;\n\n      }\n\n    }\n\n    return string;\n\n  }\n\n}\n\nexport default Base64\n","export default {\n\tlibVersion:'1.0.0',\n\tlibType:'js'\n}\n","import {SEND_TYPE,ENVIRONMENT} from '../constant'\nimport Base64 from \"../utils/base64\"\nimport { Config } from '@/types';\n//default config\nlet config:Config={\n  pageTime:true,  //是否记录页面停留时间\n  env:ENVIRONMENT.PRODUCTION,\n  console:true,\n  projectId:null,\n  token:null,\n  version:null,\n  domain:'',\n  sendType:SEND_TYPE.UNLOAD,  //发送日志方式 (同步发,异步延迟发,关闭浏览器前发送)\n  delayTime:1000,  //延迟发送的时间\n  autoTrakerPage:false,\n  autoTrakerClick:true,//自动埋点a,button,input\n  autoInstall:true,\n  delayLink:true,\n  delayLinkTime:200,\n  useServerTime:true,\n  corssSubdomain:true,  //false 域名不同认作为两个用户\n  analyseScript:\"../dist/analyse.min.js\"\n}\n\n//script tracker-key  config\nlet scriptDom = document.querySelector('script[tracker-key]')\nif(scriptDom){\n  let newConfig = Base64.decode(scriptDom.getAttribute('tracker-key') || '');\n  if(newConfig){\n    config={...config,...JSON.parse(newConfig)}\n  }\n}\n\n\n\nexport function getConfig(){\n  return config\n}\n\nexport function setConfig(data:Config){\n  config={...config,...data}\n}\n","import {ACTION_TYPE} from \"../constant/index\"\nimport { UserInfo } from '@/types';\n\nexport let userInfo:UserInfo = {\n  userId: null\n}\n\nexport function getUserInfo(){\n  return userInfo\n}\n\nexport function login(info:UserInfo) {\n  userInfo = {\n    ...userInfo,\n    ...info\n  };\n}\n\nexport function logout() {\n  userInfo = {};\n}\n\nexport function getIdentify() {}\n\nexport function changeIdentify() {}\n","import http from \"../utils/http\"\nimport trackerInfo from \"./trackerInfo\"\nimport clientInfo from \"./clientInfo\"\nimport {getConfig} from \"./config\"\nimport {setCookie,getCookie,getUUID} from \"../utils/util\"\nimport {getUserInfo} from \"./user\"\nimport {TRACKER_DATA_KEY,SEND_TYPE,TRACKER_IDENTIFY} from '../constant/index'\nimport { Data, Config } from '@/types';\n\nconst allData:Data[]=[];\nlet timer:any=null;\nlet uuid=getUUID()\nlet index=0;\n\nexport function send(data:Data){\n  const config=getConfig();\n  const sendType=config.sendType;\n\n  data=_wrapperData(data,config);\n\n  if(config.console){\n    console.log(data)\n  }\n\n  if(sendType===SEND_TYPE.UNLOAD){\n    let oldData=JSON.parse(localStorage.getItem(TRACKER_DATA_KEY)||'[]')\n    localStorage.setItem(TRACKER_DATA_KEY,JSON.stringify(oldData.concat(data)))\n  }else if(sendType===SEND_TYPE.SYNC){\n    _sendToServer([data])\n  }else if(sendType===SEND_TYPE.ASYNC){\n    allData.push(data)\n    sendAsyncData(config.delayTime)\n  }\n}\n\n\nexport function sendSync(data:Data){\n  const config=getConfig();\n  data=_wrapperData(data,config);\n  _sendToServer([data])\n}\n\n\nexport function sendCookieData(){\n  let oldData=getCookie(TRACKER_DATA_KEY)\n  if(oldData&&oldData!=='[]'){\n    _sendToServer(oldData,true).then(()=>{\n      setCookie(TRACKER_DATA_KEY,\"[]\")\n    })\n  }\n}\n\n\nexport function sendStorageData(){\n  let oldData=localStorage.getItem(TRACKER_DATA_KEY)\n  if(oldData&&oldData!=='[]'){\n    _sendToServer(oldData).then(()=>{\n      localStorage.removeItem(TRACKER_DATA_KEY)\n    })\n  }\n}\n\n\nexport function sendAsyncData(delayTime=0,unload=false){\n  if(!allData.length){\n    return;\n  }\n  clearTimeout(timer)\n  if(unload){\n    _sendToServer(JSON.stringify(allData))\n    allData.length=0;\n    return;\n  }\n  timer=setTimeout(()=>{\n    _sendToServer(JSON.stringify(allData))\n    allData.length=0;\n  },delayTime);\n}\n\n\n\nfunction _sendToServer(data:string|any[],isAjax?:boolean){\n  return http(data,isAjax)\n}\n\n\n\n\n\nfunction _wrapperData(data:Data,config:Config){\n  index++\n  return {\n    ...data,\n    ...clientInfo(),\n    ...trackerInfo,\n    ...getUserInfo(),\n    trackTime:Date.now(),\n    useServerTime:config.useServerTime,\n    identify:getCookie(config.identify||TRACKER_IDENTIFY),\n    projectId:config.projectId,\n    version:config.version,\n    uuid:uuid+\"-\"+index\n  }\n}\n","import {SERVER_URL} from '../constant/index'\nimport Base64 from './base64'\n\n\nexport default function http(data:any,isAjax=false,isSendBeacon=true){\n  return new Promise((resolve,reject)=>{\n    data=Base64.encode(JSON.stringify(data));\n    const url=`${SERVER_URL}?time=${Date.now()}`\n    if(isSendBeacon&&typeof window.navigator.sendBeacon==='function'&&typeof Blob==='function') {\n\n      const headers = {\n        type: \"text/plain; charset=UTF-8\"\n      }\n      const blob = new Blob([data], headers);\n      const success=window.navigator.sendBeacon(url, blob);\n      if(success){\n        resolve()\n        return;\n      }\n    }\n\n    if(isAjax||data.length>8000){\n      const xhr = new XMLHttpRequest();\n      xhr.withCredentials = true;\n      xhr.addEventListener(\"readystatechange\", function () {\n        if (this.readyState === 4) {\n          resolve();\n        }\n      });\n      xhr.open('POST', url, true);\n      xhr.setRequestHeader('Content-Type', 'text/plain;charset=UTF-8');\n      xhr.withCredentials = true;\n      xhr.send(data);\n    }else{\n      const img=new Image()\n      img.onload=()=>{\n        resolve();\n      }\n      img.src=`${url}&data=${data}`\n    }\n\n  })\n}\n\n\n\n\n","export default function() {\n  return {\n    clientWidth: window.screen.height,\n    clientHeight: window.screen.width,\n    title: document.title || '',\n    referrer: document.referrer || '',\n    domain: document.domain || ''\n  }\n}\n","import {send} from \"./send\"\nimport {ACTION_TYPE} from \"../constant\"\nimport {getDomPath} from \"../utils/util\"\nimport { Data } from '@/types';\n\nclass ActionTracker{\n  pageId = document.querySelector('meta[name=\"tracker-id\"]').content||null;\n  static instance:ActionTracker=null;\n  static getInstance() {\n      if (!ActionTracker.instance) {\n          ActionTracker.instance = new ActionTracker();\n      }\n      return ActionTracker.instance;\n  }\n\n  trackPage(info={}){\n    let data:Data={\n      actionType:ACTION_TYPE.PAGE,\n      url:location.origin,\n      host:location.host,\n      path:location.pathname,\n      hash:location.hash,\n      pageId:this.pageId,\n      ...info\n    }\n    this.pageId=data.pageId;\n    window._trackerPageId=this.pageId;\n    send(data)\n  }\n\n  trackEvent(info={}){\n    let data:Data={\n      actionType:ACTION_TYPE.PAGE,\n      eventName:\"CLICK\",\n      url:location.origin,\n      host:location.host,\n      path:location.pathname,\n      hash:location.hash,\n      ...info\n    }\n    this.pageId=data.pageId;\n\n    send(data)\n  }\n\n  track(info={}){\n    let data:Data={\n      actionType:ACTION_TYPE.EVENT,\n      eventName:'CLICK',\n      pageId:this.pageId,\n      url:location.origin,\n      host:location.host,\n      path:location.pathname,\n      hash:location.hash,\n      ...info\n    }\n\n    send(data)\n  }\n\n  trackLink(linkDom:HTMLElement,info={}){\n    linkDom.addEventListener('click',function(e){\n      e.preventDefault()\n      setTimeout(()=>{\n        linkDom.click()\n      },300)\n    },false)\n    if(info){\n      let data={\n        actionType:ACTION_TYPE.EVENT,\n        eventName:'CLICK',\n        url:location.origin,\n        host:location.host,\n        path:location.pathname,\n        hash:location.hash,\n        ...info\n      }\n\n      send(data)\n    }\n\n  }\n\n\n\n  trackDom(dom:HTMLLinkElement&HTMLInputElement,info={}){\n    let trackInfo:Data={\n      domId:dom.id,\n      domClass:dom.className,\n      domHref:dom.href||\"\",\n      domName:dom.name||\"\",\n      domTag:dom.tagName,\n      domContent:dom.textContent.substr(0,20),\n      domPath:getDomPath(dom),\n      pageId:this.pageId\n    }\n\n    let track=dom.dataset.track;\n\n    if(track&&track.search(/^\\{[\\S\\s]*\\}$/)>=0){\n      trackInfo={...trackInfo,...JSON.parse(track)}\n    }else{\n      trackInfo.trackId=track||\"\"\n    }\n    if(info){\n      trackInfo={...trackInfo,...info}\n    }\n    this.track(trackInfo)\n  }\n}\n\nlet instance=ActionTracker.getInstance();\n\nexport default instance\n","import {send} from \"./send\"\nimport actionTracker from \"./actionTracker\"\nimport {ACTION_TYPE} from \"../constant\"\nclass PageTimeTracker{\n  static instance:PageTimeTracker=null;\n  startTime=Date.now()\n  endTime=Date.now()\n  pageTimes:any[]=[]\n  invalidStartTime=Date.now()\n  invalidEndTime=Date.now()\n  totalInvalidTime=0\n  url=location.origin\n  pageId:string=null\n\n  static getInstance() {\n      if (!PageTimeTracker.instance) {\n          PageTimeTracker.instance = new PageTimeTracker();\n      }\n      return PageTimeTracker.instance;\n  }\n\n  start(){\n    this.startTime=Date.now();\n    this.pageTimes=[];\n    this.pageId=actionTracker.pageId\n    window.addEventListener('visibilitychange', ()=> {\n      var isHidden = document.hidden;\n      if (isHidden) {\n\n        this.invalidStartTime=Date.now()\n      } else {\n\n        this.invalidEndTime=Date.now();\n        this.totalInvalidTime+=(this.invalidEndTime-this.invalidStartTime);\n      }\n    });\n  }\n\n  end(){\n    this.change()\n    let data={\n      actionType:ACTION_TYPE.TIME,\n      url:location.origin,\n      host:location.host,\n      path:location.pathname,\n      hash:location.hash,\n      pageId:this.pageId,\n      startTime:this.startTime,\n      endTime:this.endTime,\n      pageTimes:this.pageTimes,\n      invalidTime:this.totalInvalidTime\n    }\n\n    send(data)\n\n  }\n\n  change(){\n    this.pageId=actionTracker.pageId\n    this.pageTimes.push({\n      url:this.url,\n      href: location.href,\n      pageId:this.pageId,\n      startTime:this.endTime,\n      invalidTime:this.invalidEndTime-this.invalidStartTime,\n      endTime:Date.now()\n    })\n\n    this.invalidEndTime=this.invalidStartTime=this.endTime=Date.now();\n  }\n}\n\nlet instance=PageTimeTracker.getInstance();\n\nexport default instance\n","import {\n  isThenable,\n  curryN,\n  attempt,\n  isError,\n  isFunction,\n  isArray,\n  once,\n  reduce,\n  memoize,\n  mapValues,\n} from \"../utils/util\"\nimport actionTracker from \"../core/actionTracker\"\n\nconst before = curryN(2, (trackFn:Function|string|Object, fn:Function) => function (...args:any) {\n  if(isFunction(trackFn)){\n    try {\n      let result=trackFn.apply(this, args)\n      if(typeof result==='object'){\n        actionTracker.track(result)\n      }\n    } catch(e) {\n      console.error(e)\n    }\n  }else if(typeof trackFn==='object'){\n    actionTracker.track(trackFn)\n  }else if(typeof trackFn==='string'){\n    const data={\n      trackId:trackFn\n    }\n    actionTracker.track(data)\n  }\n\n  return fn.apply(this, args)\n})\n\n\n\nconst after = curryN(2, (trackFn:Function|string|Object, fn:Function) => function (...args:any) {\n  const r:Promise<any> = fn.apply(this, args)\n\n  const self = this\n\n  const evalF = () => {\n    if(isFunction(trackFn)){\n      try {\n        let result=trackFn.apply(this, args)\n        if(typeof result==='object'){\n          actionTracker.track(result)\n        }\n      } catch(e) {\n        console.error(e)\n      }\n    }else if(typeof trackFn==='object'){\n      actionTracker.track(trackFn)\n    }else if(typeof trackFn==='string'){\n      const data={\n        trackId:trackFn\n      }\n      actionTracker.track(data)\n    }\n  }\n\n  if (isThenable(r)) {\n    return r.then(rr => {\n      evalF()\n      return rr\n    })\n  }\n\n  evalF()\n  return r\n})\n\n\nexport {\n  before,\n  after\n}\n\n\n\n\n// export const composeWith = curry((convergeFn, ops) => {\n//   if (isFunction (ops)) {\n//     ops = [ops]\n//   }\n//\n//   if (!isFunction(convergeFn) ||!isArray(ops) ) {\n//     return console.error('args type incorrect, expect convergeFn is function and ops is array')\n//   }\n//\n//   const compose = reduce((acc, i) => {\n//     if (!acc) {\n//       return acc || i\n//     }\n//     return i.call(null, acc)\n//   }, null)\n//\n//\n//   return curryN(1, (fn, target) => function (...args) {\n//     const memoizeFn = memoize(fn)\n//     const _r = convergeFn(\n//       compose(ops)\n//         .apply(this, [memoizeFn])\n//         .apply(this, args)\n//     ).apply(this, args)\n//     return memoizeFn.apply(this, args)\n//   })\n// })\n// export const createCounter = () => {\n//   let scopeCounter = 0\n//   return fn => function (...args) {\n//     fn.apply(this, args)\n//     scopeCounter = scopeCounter + 1\n//     return scopeCounter\n//   }\n// }\n// export const time = fn => function (...args) {\n//     const begin = +Date.now()\n//     const result = fn.apply(this, args)\n//     if (isThenable(result)) {\n//         return result.then(() => +Date.now() - begin)\n//     }\n//     return +Date.now() - begin\n// }\n//\n// export const evolve = curry(evols => fn => function (...args) {\n//   const self = this\n//   const memoizeFn = memoize(fn)\n//   return mapValues((value) => {\n//     return value(memoizeFn).apply(self, args)\n//   }, evols)\n// })\n//\n// export const identity = curry(fn => function (...args) {\n//   return fn.apply(this, args)\n// })\n//\n// export const nop = () => {}\n//\n// export const once = _once\n","import actionTracker from '../core/actionTracker'\nimport { notChanged, isEmpty } from '../utils/util'\n\nexport let watch:any[] = []\n\nconst trackView = {\n  bind (el:HTMLElement, binding:any) {\n    let index = watch.findIndex(element => element === el)\n    let isWatched = index !== -1\n    if (el.style.display === 'none') {\n      if (!isWatched) watch.push(el)\n      return\n    } else {\n      if (isWatched) watch.splice(index, 1)\n    }\n\n    if (!isWatched && (notChanged(binding) || isEmpty(binding))) return\n\n    let info:any = {}\n\n    if (typeof binding.value === 'object') {\n      info = binding.value\n      //if (value.pageURL) args.push(value.pageURL)\n    } else if (typeof binding.value === 'string' && binding.value) {\n      info.trackId = binding.value\n    }\n    actionTracker.trackPage(info)\n  },\n  unbind (el:HTMLElement, binding:any) {\n    let index = watch.findIndex(element => element === el)\n    if (index !== -1) watch.splice(index, 1)\n  },\n  update(el:HTMLElement, binding:any){}\n}\n\ntrackView.update = trackView.bind\n\nexport default trackView\n","import actionTracker from '../core/actionTracker'\nimport { notChanged, isEmpty } from '../utils/util'\n\n\n\nexport default function (el:HTMLElement, binding:any) {\n  if (notChanged(binding) || isEmpty(binding)) {\n    return\n  }\n\n  let info:any= {}\n  if (typeof binding.value === 'object'&&binding.value) {\n    info = binding.value\n  } else if (typeof binding.value === 'string') {\n    info.trackId=binding.value\n  } else if (typeof binding.value === 'number') {\n    info.trackId=binding.value+\"\"\n  }\n  el._trackerInfo=info;\n  el._isWatchTrack=true;//去除自动点击埋点\n\n  let events = Object.keys(binding.modifiers).filter(modifier => {\n    return binding.modifiers[modifier]\n  })\n  if (!events.length) events.push('click')\n  \n  events.forEach((event:string) => {\n    el.removeEventListener(event, handleEvent, false)\n    el.addEventListener(event, handleEvent, false)\n  })\n}\n\n\nfunction handleEvent(e:Event){\n  this._trackerInfo.eventName=e.type.toUpperCase();\n  actionTracker.trackDom(this,this._trackerInfo)\n}","import { getLocationHref } from './util'\nimport { setFlag, getFlag } from './util'\n\nexport default function() {\n  if (getFlag('historyInjected')) return\n  function historyEventTrigger(event:any, data:any) {\n    const fetchEvent = new CustomEvent(event, { detail: data })\n    window.dispatchEvent(fetchEvent)\n  }\n\n  function spellUrl(oldURL:string, newURL:string) {\n    if (/:\\/\\//.test(newURL)) {\n      return newURL\n    }\n    let host = oldURL.match(/^.*:\\/\\/[^/]+/)[0]\n    return host + (/^\\//.test(newURL) ? '' : '/') + newURL\n  }\n\n  let globalData = {\n    url: getLocationHref()\n  }\n\n  const oldOnpopstate = window.onpopstate\n  window.onpopstate = function() {\n    let data = {\n      newURL: window.location.href,\n      oldURL: globalData.url\n    }\n    globalData.url = window.location.href\n    historyEventTrigger.apply(this, ['historyPopstate', data])\n    if (oldOnpopstate) {\n      return oldOnpopstate.apply(this, arguments)\n    }\n  }\n\n  const oldPushState = window.history.pushState\n  oldPushState &&\n    (window.history.pushState = function(state, title, url) {\n      let data = {\n        newURL: spellUrl(globalData.url, url),\n        oldURL: globalData.url\n      }\n      globalData = {\n        url: data.newURL\n      }\n      historyEventTrigger.apply(this, ['historyPushState', data])\n      if (oldPushState) {\n        return oldPushState.apply(this, arguments)\n      }\n    })\n\n  setFlag('historyInjected', true)\n}\n","import actionTracker from \"./actionTracker\";\nimport pageTimeTracker from \"./pageTimeTracker\";\nimport {getConfig,setConfig} from './config';\nimport {sendCookieData,sendStorageData,sendAsyncData,send,sendSync} from \"./send\";\nimport hijackHistoryEvent from \"../utils/hijackHistoryEvent\";\nimport {SEND_TYPE,TRACKER_DATA_KEY} from '../constant';\nimport {getFlag,setFlag} from \"../utils/util\";\nimport { Config } from '@/types';\n\n\nfunction routeChange(){\n  pageTimeTracker.change();\n}\n\nconst install=function(conf?:Config){\n  if(getFlag(\"install\"))return;\n  setFlag(\"install\");\n\n  hijackHistoryEvent();\n  if(conf){\n    setConfig(conf);\n  }\n  const config=getConfig();\n\n  if(config.sendType===SEND_TYPE.UNLOAD){\n    sendStorageData();\n    //localStorage.removeItem(TRACKER_DATA_KEY)\n  }\n\n  if(config.analyseScript){\n    let trackerToken=window.name.match(/\\{trackerToken:.*\\}/);\n    if(trackerToken){\n      const oHead = document.getElementsByTagName('head').item(0);\n      const oScript= document.createElement(\"script\");\n      oScript.type = \"text/javascript\";\n      oScript.src=config.analyseScript;\n      oHead.appendChild(oScript);\n    }\n  }\n\n  if(config.autoTrakerPage){\n    actionTracker.trackPage();\n  }\n\n  if(config.pageTime){\n    pageTimeTracker.start();\n    if (typeof window.onpopstate === 'undefined') {\n      window.addEventListener('hashchange', routeChange);\n    }\n    window.addEventListener('historyPushState', routeChange);\n    window.addEventListener('historyPopstate', routeChange);\n  }\n\n  window.addEventListener('beforeunload',() => {\n    if(config.pageTime){\n      pageTimeTracker.end();\n    }\n    sendAsyncData(0,true);\n    if(config.sendType===SEND_TYPE.UNLOAD){\n      sendStorageData();\n    }\n  });\n\n  document.addEventListener('click',(e:any) => {\n    if(!e.path||!e.isTrusted){\n      return;\n    }\n\n    for(let target of e.path){\n      if(target.tagName==='BODY'||!target.dataset){\n        break;\n      }\n\n      if(target.dataset.track||config.autoTrakerClick&&(target.tagName===\"A\"||target.tagName===\"BUTTON\"||target.tagName===\"INPUT\")&&!target._isWatchTrack){\n        if(e.target.tagName==='A'&&config.delayLink&&e.target.href){\n          e.preventDefault();\n          setTimeout(() => {\n            actionTracker.trackDom(target);\n            e.target.click();\n          },config.delayLinkTime);\n        }else{\n          actionTracker.trackDom(target);\n        }\n      }\n    }\n  },false);\n};\n\nexport default install;\n","if(typeof Symbol==='undefined'|| typeof XMLHttpRequest === 'undefined'){\n  throw new Error(\n        \"tracker requires ie10+\"\n    )\n}\n\ntry {\n    process.env.NODE_ENV\n} catch (e) {\n    const g:any = typeof window !== \"undefined\" ? window : global\n    if (typeof process === \"undefined\") g.process = {}\n    g.process.env = {}\n}\n\n\nexport * from './internal'\n","import track from \"./decoratiors/track\"\nimport actionTracker from \"./core/actionTracker\"\nimport pageTimeTracker from \"./core/pageTimeTracker\"\nimport {getConfig,setConfig} from './core/config'\nimport {sendStorageData,sendAsyncData,send,sendSync} from \"./core/send\"\nimport {after,before} from \"./decoratiors/tools\"\nimport trackView from \"./directives/trackView\"\nimport trackEvent from \"./directives/trackEvent\"\nimport install from \"./core/bindEvent\"\nimport {login,logout} from \"./core/user\"\n\n\n//自动开始埋点\nwindow.addEventListener('load',()=>{\n  const config=getConfig()\n  if(config.autoInstall){\n    install()\n  }\n})\n\n\n\nexport {\n  //装饰器\n  before,\n  after,\n  track,\n  //指令\n  trackView,\n  trackEvent,\n\n  install,\n\n  //tracker\n  pageTimeTracker,\n  actionTracker,\n\n  setConfig,\n  getConfig,\n\n\n  sendStorageData,\n  sendAsyncData,\n  send,\n  sendSync,\n\n  //user\n  login,\n  logout\n}\n","import {\n  propSet,\n  isArray,\n  isFunction,\n} from \"../utils/util\"\n\nimport actionTracker from \"../core/actionTracker\"\n\n\nconst track = (partical:any,key:string,descriptor:PropertyDescriptor)=>{\n  if (isFunction(partical)) {\n    return (target:any, key:string, descriptor:PropertyDescriptor) => {\n      const value = function (...args:any) {\n        const fn=partical.call(this, descriptor.value, this)\n        if(typeof fn==='function'){//参数为高阶函数\n          return fn.apply(this, args)\n        }else{//普通函数\n          if(typeof fn==='object'){\n            const data={...fn}\n            actionTracker.track(data)\n          }\n          return descriptor.value.apply(this, arguments);\n        }\n      }\n      // if (descriptor.initializer) {\n      //   return propSet('initializer', function() {\n      //     const value = descriptor.initializer.apply(this);\n      //     return function (...args) {\n      //       return partical.call(this, value, this).apply(this, args);\n      //     }\n      //   }, descriptor);\n      // }\n      return propSet('value', value, descriptor)\n    }\n  }else if(typeof partical==='object'&&typeof partical.constructor==='function'){\n    //无参数,默认使用属性名作为trackID\n    const value=function(){\n      const data={\n        trackId:key,\n      }\n      actionTracker.track(data)\n      return propSet('value', value, descriptor)\n    }\n    return descriptor\n  }else if(typeof partical==='object'){\n\n    return (target:any, key:string, descriptor:PropertyDescriptor) =>{\n      var oldValue = descriptor.value;\n      descriptor.value=function(){\n        const data={\n          ...partical\n        }\n        actionTracker.track(data)\n        return oldValue.apply(this, arguments);\n      }\n      return descriptor\n    }\n  }else {\n    //参数为string 作为tarckId\n    return (target:any, key:string, descriptor:PropertyDescriptor) =>{\n      var oldValue = descriptor.value;\n      descriptor.value=function(){\n        const data={\n          trackId:partical,\n        }\n        actionTracker.track(data)\n        return oldValue.apply(this, arguments);\n      }\n      return descriptor\n    }\n  }\n\n\n}\n\nexport default track\n"],"names":["notChanged","binding","undefined","oldValue","value","isEqual","isEmpty","setFlag","key","window","_trackerFlag","getFlag","SERVER_URL","TRACKER_DATA_KEY","TRACKER_IDENTIFY","SEND_TYPE","ACTION_TYPE","Base64","_keyStr","encode","input","chr1","chr2","chr3","enc1","enc2","enc3","enc4","output","i","_utf8_encode","length","charCodeAt","isNaN","this","charAt","decode","replace","indexOf","String","fromCharCode","_utf8_decode","string","utftext","n","c","c3","c2","libVersion","libType","config","pageTime","env","console","projectId","token","version","domain","sendType","delayTime","autoTrakerPage","autoTrakerClick","autoInstall","delayLink","delayLinkTime","useServerTime","corssSubdomain","analyseScript","scriptDom","document","querySelector","newConfig","getAttribute","JSON","parse","getConfig","setConfig","data","userInfo","userId","allData","timer","uuid","r","Math","random","toString","index","send","_wrapperData","log","oldData","localStorage","getItem","setItem","stringify","concat","_sendToServer","push","sendAsyncData","sendStorageData","then","removeItem","unload","clearTimeout","setTimeout","isAjax","isSendBeacon","Promise","resolve","reject","url","Date","now","navigator","sendBeacon","Blob","blob","type","xhr","XMLHttpRequest","withCredentials","addEventListener","readyState","open","setRequestHeader","img","Image","onload","src","http","clientWidth","screen","height","clientHeight","width","title","referrer","trackerInfo","trackTime","identify","name","cookies","cookie","split","arr","unescape","getCookie","instance","content","ActionTracker","info","actionType","location","origin","host","path","pathname","hash","pageId","_trackerPageId","eventName","linkDom","e","preventDefault","click","dom","trackInfo","domId","id","domClass","className","domHref","href","domName","domTag","tagName","domContent","textContent","substr","domPath","toLowerCase","parentNode","unshift","join","getDomPath","track","dataset","search","trackId","getInstance","PageTimeTracker","startTime","pageTimes","actionTracker","hidden","_this","invalidStartTime","invalidEndTime","totalInvalidTime","change","endTime","invalidTime","before","curryN","trackFn","fn","_i","args","isFunction","result","apply","error","after","evalF","f","isThenable","rr","watch","trackView","bind","el","findIndex","element","isWatched","style","display","splice","trackPage","unbind","update","handleEvent","_trackerInfo","toUpperCase","trackDom","globalData","oldOnpopstate","onpopstate","newURL","oldURL","historyEventTrigger","arguments","oldPushState","history","pushState","state","test","match","spellUrl","event","fetchEvent","CustomEvent","detail","dispatchEvent","routeChange","pageTimeTracker","install","conf","hijackHistoryEvent","oHead","getElementsByTagName","item","oScript","createElement","appendChild","start","end","isTrusted","target","_isWatchTrack","_a","Symbol","Error","process","NODE_ENV","g","global","partical","descriptor","propSet","call","constructor","events","Object","keys","modifiers","filter","modifier","forEach","removeEventListener"],"mappings":"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"}