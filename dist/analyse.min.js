!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("lodash/fp"),require("popper.js"),require("lodash")):"function"==typeof define&&define.amd?define(["lodash/fp","popper.js","lodash"],t):e.tracker=t(e.fp,e.Popper,e.lodash)}(this,function(r,a,n){"use strict";a=a&&a.hasOwnProperty("default")?a.default:a;var s=function(){return(s=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},o={container:!1,delay:0,html:!1,placement:"top",title:"",template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",offset:0,arrowSelector:".tooltip-arrow, .tooltip__arrow",innerSelector:".tooltip-inner, .tooltip__inner"},l=function(){function e(e,t){var a=this;this.reference=null,this.options={},this._isOpen=!1,this._popperOptions={},this._isOpening=!1,this._tooltipNode=null,this.popperInstance=null,this._showTimeout=null,this.show=function(){return a._show(a.reference,a.options)},this.hide=function(){return a._hide()},this.dispose=function(){return a._dispose()},this.toggle=function(){return a._isOpen?a.hide():a.show()},this.updateTitleContent=function(e){return a._updateTitleContent(e)},this._events=[],this._setTooltipNodeEvent=function(n,o,e,i){var t=n.relatedreference||n.toElement||n.relatedTarget,r=function(e){var t=e.relatedreference||e.toElement||e.relatedTarget;a._tooltipNode.removeEventListener(n.type,r),o.contains(t)||a._scheduleHide(o,i.delay,i,e)};return!!a._tooltipNode.contains(t)&&(a._tooltipNode.addEventListener(n.type,r),!0)},t=s({},o,t),e.jquery&&(e=e[0]),this.reference=e;var n="string"==typeof(this.options=t).trigger?t.trigger.split(" ").filter(function(e){return-1!==["click","hover","focus"].indexOf(e)}):[];this._isOpen=!1,this._popperOptions={},this._setEventListeners(e,n,t)}return e.prototype._create=function(e,t,n,o){var i=window.document.createElement("div");i.innerHTML=t.trim();var r=i.childNodes[0];r.id="tooltip_"+Math.random().toString(36).substr(2,10),r.setAttribute("aria-hidden","false");var a=i.querySelector(this.options.innerSelector);return this._addTitleContent(e,n,o,a),r},e.prototype._addTitleContent=function(e,t,n,o){if(1===t.nodeType||11===t.nodeType)n&&o.appendChild(t);else if(r.isFunction(t)){var i=t.call(e);n?o.innerHTML=i:o.textContent=i}else n?o.innerHTML=t:o.textContent=t},e.prototype._show=function(e,t){if(this._isOpen&&!this._isOpening)return this;if(this._isOpen=!0,this._tooltipNode)return this._tooltipNode.style.visibility="visible",this._tooltipNode.setAttribute("aria-hidden","false"),this.popperInstance.update(),this;var n=e.getAttribute("title")||t.title;if(!n)return this;var o=this._create(e,t.template,n,t.html);e.setAttribute("aria-describedby",o.id);var i=this._findContainer(t.container,e);return this._append(o,i),this._popperOptions=s({},t.popperOptions,{placement:t.placement}),this._popperOptions.modifiers=s({},this._popperOptions.modifiers,{arrow:{element:this.options.arrowSelector},offset:{offset:t.offset}}),t.boundariesElement&&(this._popperOptions.modifiers.preventOverflow={boundariesElement:t.boundariesElement}),this.popperInstance=new a(e,o,this._popperOptions),this._tooltipNode=o,this},e.prototype._hide=function(){return this._isOpen&&(this._isOpen=!1,this._tooltipNode.style.visibility="hidden",this._tooltipNode.setAttribute("aria-hidden","true")),this},e.prototype._dispose=function(){var o=this;return this._events.forEach(function(e){var t=e.func,n=e.event;o.reference.removeEventListener(n,t)}),this._events=[],this._tooltipNode&&(this._hide(),this.popperInstance.destroy(),this.popperInstance.options.removeOnDestroy||(this._tooltipNode.parentNode.removeChild(this._tooltipNode),this._tooltipNode=null)),this},e.prototype._findContainer=function(e,t){return"string"==typeof e?e=window.document.querySelector(e):!1===e&&(e=t.parentNode),e},e.prototype._append=function(e,t){t.appendChild(e)},e.prototype._setEventListeners=function(o,e,i){var r=this,t=[],n=[];e.forEach(function(e){switch(e){case"hover":t.push("mouseenter"),n.push("mouseleave");break;case"focus":t.push("focus"),n.push("blur");break;case"click":t.push("click"),n.push("click")}}),t.forEach(function(e){var t=function(e){!0!==r._isOpening&&(e.usedByTooltip=!0,r._scheduleShow(o,i.delay,i,e))};r._events.push({event:e,func:t}),o.addEventListener(e,t)}),n.forEach(function(e){var n=function(e){!0!==e.usedByTooltip&&r._scheduleHide(o,i.delay,i,e)};r._events.push({event:e,func:n}),o.addEventListener(e,n),"click"===e&&i.closeOnClickOutside&&document.addEventListener("mousedown",function(e){if(r._isOpening){var t=r.popperInstance.popper;o.contains(e.target)||t.contains(e.target)||n(e)}},!0)})},e.prototype._scheduleShow=function(e,t,n,o){var i=this;this._isOpening=!0;var r=t&&t.show||t||0;this._showTimeout=window.setTimeout(function(){return i._show(e,n)},r)},e.prototype._scheduleHide=function(e,t,n,o){var i=this;if(!window._trackerAnalyseDisableDide){this._isOpening=!1;var r=t&&t.hide||t||0;window.setTimeout(function(){if(window.clearTimeout(i._showTimeout),!1!==i._isOpen&&document.body.contains(i._tooltipNode)){if("mouseleave"===o.type)if(i._setTooltipNodeEvent(o,e,t,n))return;i._hide()}},r)}},e.prototype._updateTitleContent=function(e){if(void 0!==this._tooltipNode){var t=this._tooltipNode.parentNode.querySelector(this.options.innerSelector);this._clearTitleContent(t,this.options.html,this.reference.getAttribute("title")||this.options.title),this._addTitleContent(this.reference,e,this.options.html,t),this.options.title=e,this.popperInstance.update()}else void 0!==this.options.title&&(this.options.title=e)},e.prototype._clearTitleContent=function(e,t,n){1===n.nodeType||11===n.nodeType?t&&e.removeChild(n):t?e.innerHTML="":e.textContent=""},e}(),e=function(){function e(){this.style='\n.tracker-analyse-tooltip {\n    position: absolute;\n    background: #FFC107;\n    color: #fff;\n    border-radius: 3px;\n    box-shadow: 0 0 2px rgba(0,0,0,0.2);\n    padding: 5px 10px;\n    font-size: 12px;\n    text-align: center;\n}\n\n\n\n.tracker-analyse-tooltip .tracker-analyse-tooltip-arrow {\n    width: 0;\n    height: 0;\n    border-style: solid;\n    position: absolute;\n    margin: 5px;\n}\n\n.tracker-analyse-tooltip .tracker-analyse-tooltip-arrow {\n    border-color: #FFC107;\n}\n\n\n.tracker-analyse-tooltip[x-placement^="top"] {\n    margin-bottom: 5px;\n}\n\n.tracker-analyse-tooltip[x-placement^="top"] .tracker-analyse-tooltip-arrow {\n    border-width: 5px 5px 0 5px;\n    border-left-color: transparent;\n    border-right-color: transparent;\n    border-bottom-color: transparent;\n    bottom: -5px;\n    left: calc(50% - 5px);\n    margin-top: 0;\n    margin-bottom: 0;\n}\n\n.tracker-analyse-tooltip[x-placement^="bottom"] {\n    margin-top: 5px;\n}\n.tracker-analyse-tooltip[x-placement^="bottom"] .tracker-analyse-tooltip-arrow{\n    border-width: 0 5px 5px 5px;\n    border-left-color: transparent;\n    border-right-color: transparent;\n    border-top-color: transparent;\n    top: -5px;\n    left: calc(50% - 5px);\n    margin-top: 0;\n    margin-bottom: 0;\n}\n.tracker-analyse-tooltip[x-placement^="right"] {\n    margin-left: 5px;\n}\n\n.tracker-analyse-tooltip[x-placement^="right"] .tracker-analyse-tooltip-arrow {\n    border-width: 5px 5px 5px 0;\n    border-left-color: transparent;\n    border-top-color: transparent;\n    border-bottom-color: transparent;\n    left: -5px;\n    top: calc(50% - 5px);\n    margin-left: 0;\n    margin-right: 0;\n}\n\n.tracker-analyse-tooltip[x-placement^="left"] {\n    margin-right: 5px;\n}\n\n.tracker-analyse-tooltip[x-placement^="left"] .tracker-analyse-tooltip-arrow {\n    border-width: 5px 0 5px 5px;\n    border-top-color: transparent;\n    border-right-color: transparent;\n    border-bottom-color: transparent;\n    right: -5px;\n    top: calc(50% - 5px);\n    margin-left: 0;\n    margin-right: 0;\n}\n\n\n.tracker-analyse-page{\n  white-space: pre-wrap;\n  position:fixed;\n  pointer-events: none;\n  width:100%;\n  max-width: 300px;\n  background: rgba(23,23,4,.4);\n  top: 0;\n  right: 0;\n  color: #fff;\n  font-size: 12px;\n  padding: 5px 10px;\n  z-index: 99999;\n  border-bottom-left-radius: 10px;\n}\n.tracker-analyse-page p{\n  margin-bottom: 10px;\n}\n\n.tracker-analyse-event{\n  position: fixed;\n}\n\n.tracker-analyse-event i{\n  width:20px;\n  height: 20px;\n  border-radius: 50%;\n  border:3px solid #f7780c;\n  pointer-events: none;\n  position: absolute;\n  top: 0;\n  left: 0;\n  transform: scale3d(.01, .01, .01);\n}\n\n.tracker-analyse-event i:nth-child(1){\n  animation: tracker-analyse-animation 1.5s linear infinite;\n}\n.tracker-analyse-event i:nth-child(2){\n  animation: tracker-analyse-animation 1.5s .5s linear infinite;\n}\n.tracker-analyse-event i:nth-child(3){\n  animation: tracker-analyse-animation 1.5s  1s linear infinite;\n}\n\n@keyframes tracker-analyse-animation{\n\n0% {\n  opacity: 1;\n  transform: scale3d(.1, .1, .1);\n}\n100% {\n  opacity: 0;\n  transform: scale3d(1, 1 ,1);\n}\n\n}\n\n.tracker-analyse-console-btn,.tracker-analyse-console-search{\n\n    display: inline-block;\n    line-height: 1;\n    white-space: nowrap;\n    cursor: pointer;\n    border: 1px solid #dcdfe6;\n    -webkit-appearance: none;\n    text-align: center;\n    -webkit-box-sizing: border-box;\n    box-sizing: border-box;\n    outline: 0;\n    margin: 0;\n    -webkit-transition: .1s;\n    transition: .1s;\n    font-weight: 500;\n    padding: 10px 20px;\n    font-size: 14px;\n    border-radius: 4px;\n    color: #fff;\n    background-color: #409EFF;\n    border-color: #409EFF;\n}\n.tracker-analyse-console-btn{\n  position: fixed;\n  right: 5px;\n  bottom: 5px;\n}\n.tracker-analyse-console-search{\n  padding: 7px 15px;\n  font-size: 12px;\n}\n\n.tracker-analyse-console-content{\n  display: none;\n  width:500px;\n  max-width: 100%;\n  height: 300px;\n  background: #fff;\n  border-radius: 5px;\n  position: fixed;\n  top: 50%;\n  left: 50%;\n  z-index: 9999;\n  transform: translate(-50%,-50%);\n  padding:10px 20px;\n  box-sizing: border-box;\n}\n.tracker-analyse-console-content h4{\n  margin: 10px 0;\n  font-weight: bold;\n}\n.tracker-analyse-console-form{\n  height: 34px;\n  line-height: 34px;\n  margin-bottom: 10px;\n}\n.tracker-analyse-console-form span{\n  display: inline-block;\n  margin-right: 1em;\n}\n.tracker-analyse-console-mask{\n  display: none;\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background: rgba(0,0,0,.4);\n  z-index: 9998;\n}\n.tracker-analyse-console-input{\n  display: inline-block;\n      width: 100%;\n      max-width: 150px;\n      height: 24px;\n      line-height: 1.5;\n      padding: 4px 7px;\n      font-size: 12px;\n      border: 1px solid #dcdee2;\n      border-radius: 4px;\n      color: #515a6e;\n      background-color: #fff;\n      background-image: none;\n      position: relative;\n      cursor: text;\n  }\n\n  .tracker-analyse-event-hide .tracker-analyse-event,.tracker-analyse-event-hide .tracker-analyse-tooltip{\n    display: none!important;\n  }\n',this.data={page:[{url:"http://0.0.0.0:10002/demo/vue.html",pageId:"pid3",count:1212}],event:[{url:"http://0.0.0.0:10002/demo/vue.html",name:"CLICK",pageId:"pid3",trackId:"asd",domPath:"div",domId:"aaa",count:1233,id:1},{url:"http://0.0.0.0:10002/demo/vue.html",name:"CLICK",pageId:"pid3",trackId:"asd",domPath:"div",domId:"bbb",count:1233,id:2}]},this.elements={},this.wrapper=document.createElement("div"),this.page=document.createElement("div"),this.console=document.createElement("div")}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.install=function(){var n=this,e=document.createElement("style");e.innerHTML=this.style,document.head.appendChild(e),this.wrapper.className="tracker-analyse-wrapper",this.page.className="tracker-analyse-page",this.wrapper.innerHTML='\n      <div>\n        <button class="tracker-analyse-console-btn">控制台</button>\n        <div class="tracker-analyse-console-mask"></div>\n        <div class="tracker-analyse-console-content">\n          <h4>查询条件:</h4>\n          <div class="tracker-analyse-console-form">\n            <span>时间:</span><input type="text" class="tracker-analyse-console-input">~\n            <input class="tracker-analyse-console-input" type="text">\n          </div>\n          <button class="tracker-analyse-console-search">查询</button>\n          <h4>分析设置:</h4>\n\n          <div class="tracker-analyse-console-form" >\n            <span>显示页面埋点信息:</span><input checked class="tracker-analyse-console-input-page" type="checkbox">\n          </div>\n          <div class="tracker-analyse-console-form">\n            <span>显示事件埋点信息:</span><input checked class="tracker-analyse-console-input-event" type="checkbox">\n          </div>\n          <div class="tracker-analyse-console-form">\n            <span>总是显示tooltip:</span><input class="tracker-analyse-console-input-tooltip" type="checkbox">\n          </div>\n        </div>\n      </div>\n    ';var t=this.wrapper.querySelector(".tracker-analyse-console-content"),o=this.wrapper.querySelector(".tracker-analyse-console-mask"),i=this.wrapper.querySelector(".tracker-analyse-console-btn"),r=this.wrapper.querySelector(".tracker-analyse-console-input-page"),a=this.wrapper.querySelector(".tracker-analyse-console-input-event"),s=this.wrapper.querySelector(".tracker-analyse-console-input-tooltip");this.wrapper.appendChild(this.page),o.onclick=function(){o.style.display=t.style.display="none"},i.onclick=function(){o.style.display=t.style.display="block"},r.onchange=function(e){n.page.style.display=e.target.checked?"block":"none"},s.onchange=function(e){for(var t in window._trackerAnalyseDisableDide=e.target.checked,n.elements)e.target.checked?n.elements[t].tooltip.show():n.elements[t].tooltip.hide()},a.onchange=function(e){document.body.className=e.target.checked?document.body.className.replace("tracker-analyse-event-hide",""):document.body.className+" tracker-analyse-event-hide"},document.body.appendChild(this.wrapper),this.analyseEvent(),this.analysePage(),this.bind(this.analyseEvent),void 0===window.onpopstate&&window.addEventListener("hashchange",this.analysePage),window.addEventListener("historyPushState",this.analysePage),window.addEventListener("historyPopstate",this.analysePage)},e.prototype.bind=function(o){var i=this;o=n.debounce(o,100);var e=new MutationObserver(function(e){for(var t in e){var n=i.wrapper.compareDocumentPosition(e[t].target);if(20===n||0===n)return}o.call(i)}),t=document.body;e.observe(t,{childList:!0,attributes:!0,subtree:!0})},e.prototype.analysePage=function(){var t=location.href,e=window._trackerPageId?this.data.page.find(function(e){return e.pageId===window._trackerPageId}):null;e||(e=this.data.page.find(function(e){return e.url===t})),this.page.innerHTML=e?"\n      pageId:"+e.pageId+"\n      url:"+e.url+"\n      访问次数:"+e.count+"\n    ":"当前页面未埋点"},e.prototype.analyseEvent=function(){var i=this,n=location.href;this.data.event.filter(function(e){var t=!e.trackId||!window._trackerPageId||e.trackId===window._trackerPageId||e.url===n;return i.elements[e.id]&&(i.elements[e.id].cursor.style.display="none"),t}).forEach(function(e){var t=null;if((t=e.domId?document.getElementById(e.domId):1===(t=document.querySelectorAll(e.path)).length?t[0]:null)&&"none"!==t.style.display){if(i.elements[e.id]&&i.elements[e.id].el===t)return i.elements[e.id].cursor.style.display="block",void i.elements[e.id].tooltip.updateTitleContent(e.count);var n=null;i.elements[e.id]?(i.elements[e.id].tooltip.dispose(),(n=i.elements[e.id].cursor).style.display="block"):((n=document.createElement("div")).className="tracker-analyse-event",n.style="top:"+(t.offsetTop+t.offsetHeight/2-10)+"px;left:"+(t.offsetLeft+t.offsetWidth/2-10)+"px;",n.innerHTML="\n        <i></i>\n        <i></i>\n        <i></i>\n        ",i.wrapper.appendChild(n));var o=new l(t,{placement:"top",title:e.count,trigger:"hover",container:i.wrapper||document.body,popperOptions:{onUpdate:function(e){n.style="top:"+(e.offsets.reference.top+e.offsets.reference.height/2-10)+"px;left:"+(e.offsets.reference.left+e.offsets.reference.width/2-10)+"px;"}},html:!0,template:'<div class="tracker-analyse-tooltip" role="tooltip"><div class="tracker-analyse-tooltip-arrow"></div>点击次数<div class="tracker-analyse-tooltip-inner"></div></div>',arrowSelector:".tracker-analyse-tooltip-arrow",innerSelector:".tracker-analyse-tooltip-inner"});window._trackerAnalyseDisableDide&&o.show(),i.elements[e.id]={el:t,tooltip:o,show:!0,cursor:n}}else i.elements[e.id]&&(i.elements[e.id].tooltip.hide(),i.elements[e.id].cursor.style.display)})},e.instance=null,e}().getInstance();return e.install(),e});
//# sourceMappingURL=analyse.min.js.map
