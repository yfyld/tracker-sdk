{"code":"import * as tslib_1 from \"tslib\";\r\nimport http from \"../utils/http\";\r\nimport trackerInfo from \"./trackerInfo\";\r\nimport clientInfo from \"./clientInfo\";\r\nimport { getConfig } from \"./config\";\r\nimport { getCookie, getUUID } from \"../utils/util\";\r\nimport { getUserInfo } from \"./user\";\r\nimport { SEND_TYPE, TRACKER_IDENTIFY } from '../constant/index';\r\nimport isArray from 'lodash-es/isArray';\r\nvar allData = [];\r\nvar timer = null;\r\nvar uuid = getUUID();\r\nvar index = 0;\r\nvar pageTimeData = [];\r\nexport function send(data) {\r\n    var config = getConfig();\r\n    var sendType = config.sendType;\r\n    if (sendType === SEND_TYPE.SYNC) {\r\n        sendSync(data);\r\n    }\r\n    else if (sendType === SEND_TYPE.ASYNC) {\r\n        sendAsync(data);\r\n    }\r\n}\r\nexport function sendSync(data) {\r\n    var config = getConfig();\r\n    data = _wrapperData(data, config);\r\n    _sendToServer(data);\r\n}\r\nexport function sendAsync(data) {\r\n    if (!data) {\r\n        if (allData.length > 0) {\r\n            _sendToServer(allData);\r\n            allData.length = 0;\r\n        }\r\n        clearTimeout(timer);\r\n        return;\r\n    }\r\n    var config = getConfig();\r\n    data = _wrapperData(data, config);\r\n    allData.push(data);\r\n    clearTimeout(timer);\r\n    timer = setTimeout(function () {\r\n        _sendToServer(allData);\r\n        allData.length = 0;\r\n    }, config.delayTime);\r\n}\r\nfunction _sendToServer(data, isAjax) {\r\n    console.log(JSON.stringify(data, null, 2));\r\n    if (!isArray(data)) {\r\n        data = [data];\r\n    }\r\n    return http(JSON.stringify(data), isAjax);\r\n}\r\nfunction _wrapperData(data, config) {\r\n    index++;\r\n    return tslib_1.__assign({ url: location.origin, host: location.host, path: location.pathname, hash: location.hash }, data, clientInfo(), trackerInfo, getUserInfo(), { trackTime: Date.now(), useServerTime: config.useServerTime, identify: getCookie(config.identify || TRACKER_IDENTIFY), projectId: config.projectId, version: config.version, uuid: uuid + \"-\" + index });\r\n}\r\n//# sourceMappingURL=send.js.map","map":"{\"version\":3,\"file\":\"send.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../src/core/send.ts\"],\"names\":[],\"mappings\":\"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\"}"}
