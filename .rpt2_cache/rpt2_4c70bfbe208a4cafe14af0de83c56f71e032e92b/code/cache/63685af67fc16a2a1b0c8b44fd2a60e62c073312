{"code":"import * as tslib_1 from \"tslib\";\r\nimport { send } from \"./send\";\r\nimport { ACTION_TYPE } from \"../constant\";\r\nimport { getDomPath } from \"../utils/util\";\r\nimport pageTimeTracker from './pageTimeTracker';\r\nimport { getConfig } from './config';\r\nimport performanceTracker from './performanceTracker';\r\nvar ActionTracker = /** @class */ (function () {\r\n    function ActionTracker() {\r\n    }\r\n    ActionTracker.getInstance = function () {\r\n        if (!ActionTracker.instance) {\r\n            ActionTracker.instance = new ActionTracker();\r\n        }\r\n        return ActionTracker.instance;\r\n    };\r\n    ActionTracker.prototype.trackPage = function (info) {\r\n        if (info === void 0) { info = {}; }\r\n        var data = tslib_1.__assign({ actionType: ACTION_TYPE.PAGE }, info);\r\n        pageTimeTracker.info = data;\r\n        var config = getConfig();\r\n        if (!config.pageTime) {\r\n            send(data);\r\n        }\r\n    };\r\n    ActionTracker.prototype.trackEvent = function (info) {\r\n        if (info === void 0) { info = {}; }\r\n        var data = tslib_1.__assign({ actionType: ACTION_TYPE.EVENT, eventName: \"CLICK\" }, info);\r\n        send(data);\r\n    };\r\n    ActionTracker.prototype.track = function (info) {\r\n        if (info === void 0) { info = {}; }\r\n        if (info.actionType === ACTION_TYPE.PAGE) {\r\n            this.trackPage(info);\r\n        }\r\n        else {\r\n            this.trackEvent(info);\r\n        }\r\n    };\r\n    ActionTracker.prototype.trackLink = function (linkDom, info) {\r\n        if (info === void 0) { info = {}; }\r\n        linkDom.addEventListener('click', function (e) {\r\n            e.preventDefault();\r\n            setTimeout(function () {\r\n                linkDom.click();\r\n            }, 300);\r\n        }, false);\r\n        var trackInfo = tslib_1.__assign({ href: linkDom.href || \"\", domId: linkDom.id, domClass: linkDom.className, domTag: linkDom.tagName, domContent: linkDom.textContent.substr(0, 20), domPath: getDomPath(linkDom) }, info);\r\n        this.trackEvent(trackInfo);\r\n    };\r\n    ActionTracker.prototype.trackDom = function (dom, info) {\r\n        if (info === void 0) { info = {}; }\r\n        var trackInfo = {\r\n            domId: dom.id,\r\n            domClass: dom.className,\r\n            domHref: dom.href || \"\",\r\n            domName: dom.name || \"\",\r\n            domTag: dom.tagName,\r\n            domContent: dom.textContent.substr(0, 20),\r\n            domPath: getDomPath(dom)\r\n        };\r\n        var track = dom.dataset.track;\r\n        if (track && track.search(/^\\{[\\S\\s]*\\}$/) >= 0) {\r\n            trackInfo = tslib_1.__assign({}, trackInfo, JSON.parse(track));\r\n        }\r\n        else {\r\n            trackInfo.trackId = track || \"\";\r\n        }\r\n        if (info) {\r\n            trackInfo = tslib_1.__assign({}, trackInfo, info);\r\n        }\r\n        this.trackEvent(trackInfo);\r\n    };\r\n    ActionTracker.prototype.trackPerformance = function () {\r\n        var _this = this;\r\n        var info = performanceTracker.getRenderTiming();\r\n        if (info.loadPage <= 0) {\r\n            setTimeout(function () {\r\n                _this.trackPerformance();\r\n            }, 300);\r\n            return;\r\n        }\r\n        var data = tslib_1.__assign({ actionType: ACTION_TYPE.PERFORMANCE }, info);\r\n        send(data);\r\n    };\r\n    ActionTracker.instance = null;\r\n    return ActionTracker;\r\n}());\r\nvar instance = ActionTracker.getInstance();\r\nexport default instance;\r\n//# sourceMappingURL=actionTracker.js.map","map":"{\"version\":3,\"file\":\"actionTracker.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../src/core/actionTracker.ts\"],\"names\":[],\"mappings\":\";AAAA,OAAO,EAAC,IAAI,EAAC,MAAM,QAAQ,CAAA;AAC3B,OAAO,EAAC,WAAW,EAAC,MAAM,aAAa,CAAA;AACvC,OAAO,EAAC,UAAU,EAAC,MAAM,eAAe,CAAA;AAExC,OAAO,eAAe,MAAM,mBAAmB,CAAC;AAChD,OAAO,EAAE,SAAS,EAAE,MAAM,UAAU,CAAC;AACrC,OAAO,kBAAkB,MAAM,sBAAsB,CAAA;AAIrD;IAAA;IAiGA,CAAC;IA/FQ,yBAAW,GAAlB;QACI,IAAI,CAAC,aAAa,CAAC,QAAQ,EAAE;YACzB,aAAa,CAAC,QAAQ,GAAG,IAAI,aAAa,EAAE,CAAC;SAChD;QACD,OAAO,aAAa,CAAC,QAAQ,CAAC;IAClC,CAAC;IAED,iCAAS,GAAT,UAAU,IAAmB;QAAnB,qBAAA,EAAA,SAAmB;QAC3B,IAAI,IAAI,sBACN,UAAU,EAAC,WAAW,CAAC,IAAI,IACxB,IAAI,CACR,CAAA;QACD,eAAe,CAAC,IAAI,GAAC,IAAI,CAAC;QAC1B,IAAM,MAAM,GAAG,SAAS,EAAE,CAAA;QAC1B,IAAG,CAAC,MAAM,CAAC,QAAQ,EAAC;YAClB,IAAI,CAAC,IAAI,CAAC,CAAA;SACX;IACH,CAAC;IAED,kCAAU,GAAV,UAAW,IAAmB;QAAnB,qBAAA,EAAA,SAAmB;QAC5B,IAAI,IAAI,sBACN,UAAU,EAAC,WAAW,CAAC,KAAK,EAC5B,SAAS,EAAC,OAAO,IACd,IAAI,CACR,CAAA;QACD,IAAI,CAAC,IAAI,CAAC,CAAA;IACZ,CAAC;IAED,6BAAK,GAAL,UAAM,IAAmB;QAAnB,qBAAA,EAAA,SAAmB;QACvB,IAAG,IAAI,CAAC,UAAU,KAAG,WAAW,CAAC,IAAI,EAAC;YACpC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAA;SACrB;aAAI;YACH,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,CAAA;SACtB;IACH,CAAC;IAED,iCAAS,GAAT,UAAU,OAAuB,EAAC,IAAmB;QAAnB,qBAAA,EAAA,SAAmB;QACnD,OAAO,CAAC,gBAAgB,CAAC,OAAO,EAAC,UAAS,CAAC;YACzC,CAAC,CAAC,cAAc,EAAE,CAAA;YAClB,UAAU,CAAC;gBACT,OAAO,CAAC,KAAK,EAAE,CAAA;YACjB,CAAC,EAAC,GAAG,CAAC,CAAA;QACR,CAAC,EAAC,KAAK,CAAC,CAAA;QACR,IAAI,SAAS,sBACX,IAAI,EAAC,OAAO,CAAC,IAAI,IAAE,EAAE,EACrB,KAAK,EAAC,OAAO,CAAC,EAAE,EAChB,QAAQ,EAAC,OAAO,CAAC,SAAS,EAC1B,MAAM,EAAC,OAAO,CAAC,OAAO,EACtB,UAAU,EAAC,OAAO,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,EAAC,EAAE,CAAC,EAC3C,OAAO,EAAC,UAAU,CAAC,OAAO,CAAC,IACxB,IAAI,CACR,CAAA;QACD,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,CAAA;IAC5B,CAAC;IAID,gCAAQ,GAAR,UAAS,GAAoC,EAAC,IAAmB;QAAnB,qBAAA,EAAA,SAAmB;QAC/D,IAAI,SAAS,GAAa;YACxB,KAAK,EAAC,GAAG,CAAC,EAAE;YACZ,QAAQ,EAAC,GAAG,CAAC,SAAS;YACtB,OAAO,EAAC,GAAG,CAAC,IAAI,IAAE,EAAE;YACpB,OAAO,EAAC,GAAG,CAAC,IAAI,IAAE,EAAE;YACpB,MAAM,EAAC,GAAG,CAAC,OAAO;YAClB,UAAU,EAAC,GAAG,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,EAAC,EAAE,CAAC;YACvC,OAAO,EAAC,UAAU,CAAC,GAAG,CAAC;SACxB,CAAA;QAED,IAAI,KAAK,GAAC,GAAG,CAAC,OAAO,CAAC,KAAK,CAAC;QAE5B,IAAG,KAAK,IAAE,KAAK,CAAC,MAAM,CAAC,eAAe,CAAC,IAAE,CAAC,EAAC;YACzC,SAAS,wBAAK,SAAS,EAAI,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAA;SAC9C;aAAI;YACH,SAAS,CAAC,OAAO,GAAC,KAAK,IAAE,EAAE,CAAA;SAC5B;QACD,IAAG,IAAI,EAAC;YACN,SAAS,wBAAK,SAAS,EAAI,IAAI,CAAC,CAAA;SACjC;QACD,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,CAAA;IAC5B,CAAC;IAED,wCAAgB,GAAhB;QAAA,iBAaC;QAZC,IAAM,IAAI,GAAC,kBAAkB,CAAC,eAAe,EAAE,CAAC;QAChD,IAAG,IAAI,CAAC,QAAQ,IAAE,CAAC,EAAC;YAClB,UAAU,CAAC;gBACT,KAAI,CAAC,gBAAgB,EAAE,CAAC;YAC1B,CAAC,EAAC,GAAG,CAAC,CAAA;YACN,OAAO;SACR;QACD,IAAI,IAAI,sBACN,UAAU,EAAC,WAAW,CAAC,WAAW,IAC/B,IAAI,CACR,CAAA;QACD,IAAI,CAAC,IAAI,CAAC,CAAA;IACZ,CAAC;IA/FM,sBAAQ,GAAe,IAAI,CAAC;IAgGrC,oBAAC;CAAA,AAjGD,IAiGC;AAED,IAAI,QAAQ,GAAC,aAAa,CAAC,WAAW,EAAE,CAAC;AAEzC,eAAe,QAAQ,CAAA\"}"}
