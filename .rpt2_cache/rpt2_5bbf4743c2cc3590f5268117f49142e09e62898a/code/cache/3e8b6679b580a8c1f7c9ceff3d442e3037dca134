{"code":"import actionTracker from \"./actionTracker\";\r\nimport pageTimeTracker from \"./pageTimeTracker\";\r\nimport { getConfig, setConfig } from './config';\r\nimport { sendAsync } from \"./send\";\r\nimport hijackHistoryEvent from \"../utils/hijackHistoryEvent\";\r\nimport { getFlag, setFlag } from \"../utils/util\";\r\nfunction routeChange() {\r\n    pageTimeTracker.change();\r\n}\r\nvar install = function (conf) {\r\n    if (getFlag(\"install\"))\r\n        return;\r\n    setFlag(\"install\");\r\n    hijackHistoryEvent();\r\n    if (conf) {\r\n        setConfig(conf);\r\n    }\r\n    var config = getConfig();\r\n    if (config.analyseScript) {\r\n        var trackerToken = window.name.match(/\\{\"trackerToken\":.*\\}/);\r\n        if (trackerToken) {\r\n            var oHead_1 = document.getElementsByTagName('head').item(0);\r\n            var oScript_1 = document.createElement(\"script\");\r\n            oScript_1.type = \"text/javascript\";\r\n            oScript_1.src = config.analyseScript;\r\n            oHead_1.appendChild(oScript_1);\r\n        }\r\n        var oHead = document.getElementsByTagName('head').item(0);\r\n        var oScript = document.createElement(\"script\");\r\n        oScript.type = \"text/javascript\";\r\n        oScript.src = config.analyseScript;\r\n        oHead.appendChild(oScript);\r\n    }\r\n    if (config.autoTrakerPage) {\r\n        actionTracker.trackPage();\r\n    }\r\n    if (config.performance) {\r\n        actionTracker.trackPerformance();\r\n    }\r\n    if (config.pageTime) {\r\n        pageTimeTracker.start();\r\n    }\r\n    if (config.watchHistoryAndHash) {\r\n        if (typeof window.onpopstate === 'undefined') {\r\n            window.addEventListener('hashchange', routeChange);\r\n        }\r\n        window.addEventListener('historyPushState', routeChange);\r\n        window.addEventListener('historyPopstate', routeChange);\r\n    }\r\n    window.addEventListener('beforeunload', function () {\r\n        if (config.pageTime) {\r\n            pageTimeTracker.end();\r\n        }\r\n        sendAsync();\r\n    });\r\n    document.addEventListener('click', function (e) {\r\n        if (!e.path || !e.isTrusted) {\r\n            return;\r\n        }\r\n        var _loop_1 = function (target) {\r\n            if (target.tagName === 'BODY' || !target.dataset) {\r\n                return \"break\";\r\n            }\r\n            if (target.dataset.track || config.autoTrakerClick && (target.tagName === \"A\" || target.tagName === \"BUTTON\" || target.tagName === \"INPUT\") && !target._isWatchTrack) {\r\n                if (e.target.tagName === 'A' && config.delayLink && e.target.href) {\r\n                    e.preventDefault();\r\n                    setTimeout(function () {\r\n                        actionTracker.trackDom(target);\r\n                        e.target.click();\r\n                    }, config.delayLinkTime);\r\n                }\r\n                else {\r\n                    actionTracker.trackDom(target);\r\n                }\r\n            }\r\n        };\r\n        for (var _i = 0, _a = e.path; _i < _a.length; _i++) {\r\n            var target = _a[_i];\r\n            var state_1 = _loop_1(target);\r\n            if (state_1 === \"break\")\r\n                break;\r\n        }\r\n    }, false);\r\n};\r\nwindow.addEventListener('load', function () {\r\n    var config = getConfig();\r\n    if (config.autoInstall) {\r\n        install();\r\n    }\r\n});\r\nexport default install;\r\n//# sourceMappingURL=bindEvent.js.map","map":"{\"version\":3,\"file\":\"bindEvent.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../src/core/bindEvent.ts\"],\"names\":[],\"mappings\":\"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\"}"}
