{"code":"import vissense from \"vissense\";\r\nvar VisSense = vissense(window);\r\nvar VisSenseUtils = VisSense.Utils;\r\nvar createInnerMonitor = function (outerMonitor, callback, config) {\r\n    var timeElapsed = 0;\r\n    var timeStarted = null;\r\n    var timeLimit = config.timeLimit;\r\n    var percentageLimit = config.percentageLimit;\r\n    var interval = config.interval;\r\n    return VisSense.VisMon.Builder(outerMonitor.visobj())\r\n        .strategy(new VisSense.VisMon.Strategy.PollingStrategy({ interval: interval }))\r\n        .on('update', function (monitor) {\r\n        var percentage = monitor.state().percentage;\r\n        if (percentage < percentageLimit) {\r\n            timeStarted = null;\r\n        }\r\n        else {\r\n            var now = VisSenseUtils.now();\r\n            timeStarted = timeStarted || now;\r\n            timeElapsed = now - timeStarted;\r\n        }\r\n        if (timeElapsed >= timeLimit) {\r\n            monitor.stop();\r\n            outerMonitor.stop();\r\n            callback(monitor);\r\n        }\r\n    })\r\n        .on('stop', function () {\r\n        timeStarted = null;\r\n    }).build();\r\n};\r\nvar onPercentageTimeTestPassed = function (visobj, callback, config) {\r\n    var _config = VisSenseUtils.defaults(config, {\r\n        percentageLimit: 1,\r\n        timeLimit: 1000,\r\n        interval: 100,\r\n        strategy: undefined\r\n    });\r\n    // monitor is considered hidden if it is 1% below the percentage limit\r\n    var hiddenLimit = Math.max(_config.percentageLimit - 0.001, 0);\r\n    var innerMonitor = null;\r\n    var outerMonitor = VisSense.VisMon.Builder(new VisSense(visobj.element(), {\r\n        hidden: hiddenLimit,\r\n        referenceWindow: visobj.referenceWindow()\r\n    }))\r\n        .set('strategy', _config.strategy)\r\n        .on('visible', function (monitor) {\r\n        if (innerMonitor === null) {\r\n            innerMonitor = createInnerMonitor(monitor, callback, _config);\r\n        }\r\n        innerMonitor.start();\r\n    })\r\n        .on('hidden', function () {\r\n        if (innerMonitor !== null) {\r\n            innerMonitor.stop();\r\n        }\r\n    })\r\n        .on('stop', function () {\r\n        if (innerMonitor !== null) {\r\n            innerMonitor.stop();\r\n        }\r\n    })\r\n        .build();\r\n    outerMonitor.start();\r\n    return function () {\r\n        outerMonitor.stop();\r\n        innerMonitor = null;\r\n    };\r\n};\r\nVisSense.fn.onPercentageTimeTestPassed = function (callback, config) {\r\n    onPercentageTimeTestPassed(this, callback, config);\r\n};\r\nexport default VisSense;\r\n//# sourceMappingURL=viewTracker.js.map","map":"{\"version\":3,\"file\":\"viewTracker.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../src/core/viewTracker.ts\"],\"names\":[],\"mappings\":\"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\"}"}
